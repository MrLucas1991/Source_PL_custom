{{!< default}}

<main class="gh-main gh-outer">
  <header class="gh-article-header gh-account-header">
    <h1 class="gh-article-title is-title">Moje konto</h1>
    <p class="gh-article-excerpt is-body">Zarządzaj swoimi danymi i subskrypcjami.</p>
  </header>

  <section class="gh-content gh-canvas is-body">
    {{#if @member}}
      <!-- Dane główne członka -->
      <div class="gh-account-details">
        <table class="account-table">
          <tr>
            <th>Imię</th>
            <td>{{@member.name}}</td>
          </tr>
          <tr>
            <th>E-mail</th>
            <td>{{@member.email}}</td>
          </tr>
          <tr>
            <th>Status subskrypcji</th>
            <td>
              <span class="gh-account-status {{#if @member.paid}}active{{else}}inactive{{/if}}">
                {{#if @member.paid}}Aktywna{{else}}Brak aktywnej subskrypcji{{/if}}
              </span>
            </td>
          </tr>
        </table>
      </div>

      <!-- Formularz edycji profilu -->
      <div class="gh-account-edit-form" style="margin-top:32px;">
        <h2>Zmień dane profilu</h2>
        <form id="profile-update-form">
          <label for="name">Imię:</label>
          <input type="text" id="name" name="name" placeholder="Twoje imię" value="{{@member.name}}">

          <label for="avatar">URL zdjęcia profilowego:</label>
          <input type="url" id="avatar" name="avatar" placeholder="https://..." value="{{@member.avatar}}">

          <button type="submit" class="gh-button">Zapisz zmiany</button>
          <p id="update-feedback" style="margin-top:10px;"></p>
        </form>
      </div>

      <!-- Szczegółowe dane subskrypcji -->
      {{#if @member.subscriptions}}
        {{#foreach @member.subscriptions}}
          <div class="subscription" style="margin-top:32px;">
            <table class="account-table">
              <tr>
                <th>Plan</th>
                <td>{{price plan}}/{{plan.interval}}</td>
              </tr>
              <tr>
                <th>Kwota planu</th>
                <td>{{plan.amount}}</td>
              </tr>
              <tr>
                <th>Status</th>
                <td>{{status}}</td>
              </tr>
              <tr>
                <th>Data rozpoczęcia</th>
                <td>{{date start_date format="DD MMM YYYY"}}</td>
              </tr>
              <tr>
                <th>Karta</th>
                <td>**** **** **** {{default_payment_card_last4}}</td>
              </tr>
              <tr>
                <th>
                  {{#if cancel_at_period_end}}
                    Wygasa
                  {{else}}
                    Następna płatność
                  {{/if}}
                </th>
                <td>{{date current_period_end format="DD MMM YYYY"}}</td>
              </tr>
            </table>
            <div class="gh-account-cancel">
              {{cancel_link}}
            </div>
          </div>
        {{/foreach}}
      {{else}}
        <p class="gh-account-helper">Brak aktywnej subskrypcji.</p>
      {{/if}}

      <!-- Przycisk wylogowania -->
      <button class="gh-button gh-button-secondary" type="submit" data-members-signout aria-label="Wyloguj się" style="margin-top:24px;">
        <span>Wyloguj się</span>
        {{> "icons/loader"}}
      </button>

      <p class="gh-account-helper" style="margin-top:16px;">
        Masz problem? <a href="{{@site.url}}/kontakt/">Skontaktuj się z nami</a>.
      </p>

    {{else}}
      <p class="gh-account-helper">
        Nie jesteś zalogowany. <a href="{{@site.url}}/login/">Zaloguj się</a> lub <a href="{{@site.url}}/signup/">Zarejestruj się</a>.
      </p>
    {{/if}}
  </section>

  <!-- Skrypt aktualizacji profilu -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('profile-update-form');
      const feedback = document.getElementById('update-feedback');

      if (form) {
        form.addEventListener('submit', async function (e) {
          e.preventDefault();

          const name = document.getElementById('name').value;
          const avatar = document.getElementById('avatar').value;

          try {
            await ghost.members.api.member.update({ name, avatar });
            feedback.innerText = "✅ Zaktualizowano dane!";
          } catch (err) {
            feedback.innerText = "❌ Wystąpił błąd przy zapisie.";
          }
        });
      }
    });
  </script>
</main>
