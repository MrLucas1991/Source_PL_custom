{{^if @member.paid}}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const contentContainer = document.getElementById("dynamic-content");
  const rawContentElement = document.getElementById("raw-content");

  if (!contentContainer || !rawContentElement) return;

  const rawHTML = rawContentElement.innerHTML;
  const adCode = `
    <div class="adsense-block">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-8181982052718057"
           data-ad-slot="2525872787"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
    </div>`;

  const subscribeBox = `
    <div class="subscribe-cta-box">
      <h2>Pokonaj algorytmy i dołącz do Subskrybentów!<br><span>Jednocześnie wspieraj moją pracę.</span></h2>
      <ul>
        <li>Dostęp do wszystkich artykułów</li>
        <li>Czytaj wygodnie! Nawigacyjny spis treści</li>
        <li>Artykuły na Twoją skrzynkę e-mail</li>
      </ul>
      <a class="subscribe-cta-button" href="/subskrypcja">Zostań subskrybentem</a>
      <div class="subscribe-cta-login">Masz już konto? <a href="/login">Zaloguj się</a></div>
    </div>`;

  const tempDiv = document.createElement("div");
  tempDiv.innerHTML = rawHTML;

  const paragraphs = tempDiv.querySelectorAll("p");
  paragraphs.forEach((p, i) => {
    const mod3 = (i + 1) % 3 === 0;
    const mod6 = (i + 1) % 6 === 0;
    const prev = p.previousElementSibling;

    if (mod6 && (!prev || !prev.classList.contains("adsense-block"))) {
      const box = document.createElement("div");
      box.innerHTML = subscribeBox;
      p.parentNode.insertBefore(box, p.nextSibling);
    } else if (mod3) {
      const ad = document.createElement("div");
      ad.innerHTML = adCode;
      p.parentNode.insertBefore(ad, p.nextSibling);
    }
  });

  contentContainer.innerHTML = tempDiv.innerHTML;

  const ads = document.querySelectorAll('.adsbygoogle');
  if (ads.length > 0 && !window.adsbygoogleInitialized) {
    const script = document.createElement('script');
    script.async = true;
    script.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8181982052718057";
    script.crossOrigin = "anonymous";
    document.head.appendChild(script);

    script.onload = () => {
      window.adsbygoogleInitialized = true;
      ads.forEach(ad => {
        try {
          (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) {
          console.error('AdSense error:', e);
        }
      });
    };
  }
});
</script>
{{/if}}
